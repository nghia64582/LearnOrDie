D∆∞·ªõi ƒë√¢y l√† ph·∫ßn gi·∫£i th√≠ch chu·∫©n backend production v·ªÅ:
*  Cache Miss l√† g√¨
*  Outdated / Stale Cache l√† g√¨
*  Nguy√™n nh√¢n
*  C√°ch x·ª≠ l√Ω ƒë√∫ng trong Redis + Backend
---
#  1. Cache Miss l√† g√¨?
	> Cache Miss = Kh√¥ng t√¨m th·∫•y d·ªØ li·ªáu trong cache  ph·∫£i xu·ªëng DB l·∫•y l·∫°i
	V√≠ d·ª•:
		redis.get("user:1")  null  
		 Query DB
		 Set l·∫°i Redis
	
---
##  C√°c lo·∫°i Cache Miss
| Lo·∫°i                  | √ù nghƒ©a                   |
| --------------------- | ------------------------- |
| **Cold Miss**         | L·∫ßn ƒë·∫ßu ch∆∞a c√≥ cache     |
| **Capacity Miss**     | B·ªã Redis eviction x√≥a m·∫•t |
| **Invalidation Miss** | Cache b·ªã x√≥a do update    |
| **Key Miss**          | Sai key                   |
---
	##  Cache Miss c√≥ nguy hi·ªÉm kh√¥ng?
	| Tr∆∞·ªùng h·ª£p       | Nguy hi·ªÉm           |
	| ---------------- | ------------------- |
	| Nh·∫π (√≠t request) | ‚ùå                   |
	| Cao t·∫£i          | ‚úÖ **R·∫§T NGUY HI·ªÇM** |
	 V√¨:
	* H√†ng lo·∫°t request c√πng l√∫c  c√πng miss
	* T·∫•t c·∫£ d·ªìn xu·ªëng DB  DB ch·∫øt
	  => G·ªçi l√† Cache Stampede
---
#  2. Outdated Cache (Stale Cache) l√† g√¨?
> Outdated Cache = Cache c√≤n t·ªìn t·∫°i nh∆∞ng d·ªØ li·ªáu ƒë√£ l·ªói th·ªùi so v·ªõi DB
V√≠ d·ª•:
* DB: user = "Trung"
* Cache: user = "Nghƒ©a"
* User th·∫•y sai d·ªØ li·ªáu 
---
	##  Nguy√™n nh√¢n Cache b·ªã Outdate
	| Nguy√™n nh√¢n                     | V√≠ d·ª•                                        |
	| ------------------------------- | -------------------------------------------- |
	| DB update nh∆∞ng kh√¥ng x√≥a cache | Update user nh∆∞ng qu√™n DEL Redis             |
	| Multi service                   | Service A update DB, Service B d√πng cache c≈© |
	| TTL qu√° d√†i                     | Cache 24h nh∆∞ng DB ƒë·ªïi li√™n t·ª•c              |
	| Event kh√¥ng ƒë·ªìng b·ªô             | Kh√¥ng d√πng MQ                                |
---
#  3. So s√°nh Cache Miss vs Outdated Cache
| Ti√™u ch√≠           | Cache Miss  | Outdated Cache |
| ------------------ | ----------- | -------------- |
| C√≥ key trong Redis | ‚ùå Kh√¥ng     | ‚úÖ C√≥           |
| C√≥ d·ªØ li·ªáu         | ‚ùå Kh√¥ng     | ‚úÖ C√≥ (sai)     |
| G√¢y sai d·ªØ li·ªáu    | ‚ùå           | ‚úÖ              |
| G√¢y qu√° t·∫£i DB     | ‚úÖ           | ‚ùå              |
| M·ª©c ƒë·ªô nguy hi·ªÉm   | ‚ö† Hi·ªáu nƒÉng | üö® Logic       |
---
#  4. C√°ch x·ª≠ l√Ω Cache Miss (CH·ªêNG S·∫¨P DB)
---
##  4.1 Cache Aside Pattern (chu·∫©n nh·∫•t)
	Client  Redis  Miss  DB  Set Redis  Tr·∫£ v·ªÅ
Code pseudo:
	String key = "user:1";
	User user = redis.get(key);
	if (user == null) {
		    user = db.findUser(1);
		    redis.set(key, user, 60); // TTL
	}
 90% h·ªá th·ªëng d√πng c√°ch n√†y
---
##  4.2 Ch·ªëng Cache Stampede (R·∫§T QUAN TR·ªåNG)
	###  C√°ch 1: Distributed Lock
		SET lock:user:1 1 NX EX 5
	
	Pseudo:
	
		if (redis.get(key) == null) {
			   if (tryLock()) {
			       data = db.get();
			       redis.set(key, data, 60);
			       unlock();
		   } else {
			       sleep(50);
			       retry();
		   }
		}
	
---
###  C√°ch 2: Logical Expire (Cache kh√¥ng bao gi·ªù null)
Cache l∆∞u:
	{
	  "data": {...},
		  "expireAt": 1700000000
	}
* H·∫øt h·∫°n  tr·∫£ d·ªØ li·ªáu c≈©
* Ng·∫ßm refresh DB async
 R·∫•t m·∫°nh cho:
* Hot key
* Homepage
* Product top view
---
	###  C√°ch 3: Pre-Warm Cache
	* Load s·∫µn d·ªØ li·ªáu hot khi app start
	* Tr√°nh Cold Miss
---
#  5. C√°ch x·ª≠ l√Ω Outdated Cache (TR√ÅNH SAI D·ªÆ LI·ªÜU)
---
##  5.1 Update DB  X√ìA CACHE (Chu·∫©n nh·∫•t)
		Update DB  DEL Redis
	
		db.updateUser(user);
		redis.del("user:" + user.getId());
	
	 Khi request sau t·ªõi  t·ª± cache l·∫°i
	
---
##  5.2 Write Through (Ghi song song DB + Redis)
	db.save(user);
	redis.set("user:1", user, 60);
 √Åp l·ª±c ghi Redis r·∫•t l·ªõn
---
##  5.3 Event-Driven Cache Invalidation (Microservice)
		Service A update DB
		 Push Kafka/Redis Stream
		 Service B x√≥a cache
	
	 Chu·∫©n h·ªá th·ªëng l·ªõn
	
---
##  5.4 TTL ng·∫Øn cho d·ªØ li·ªáu hay ƒë·ªïi
| Lo·∫°i d·ªØ li·ªáu | TTL          |
| ------------ | ------------ |
| User profile | 10‚Äì30 ph√∫t   |
| S·∫£n ph·∫©m     | 5‚Äì10 ph√∫t    |
| Gi√° c·∫£       | 30s ‚Äì 2 ph√∫t |
| Homepage     | 30s          |
---
#  6. T·ªïng h·ª£p chi·∫øn thu·∫≠t chu·∫©n Production
	| B√†i to√°n                | Gi·∫£i ph√°p             |
	| ----------------------- | --------------------- |
	| Cache Miss              | Cache Aside           |
	| DB s·∫≠p khi miss         | Lock / Logical Expire |
	| Cache b·ªã sai            | Update DB ‚Üí DEL cache |
	| Microservice l·ªách cache | MQ invalidation       |
	| Key qu√° hot             | Logical expire        |
---
#  7. M·ªôt lu·ªìng th·ª±c t·∫ø ƒë·∫ßy ƒë·ªß (Chu·∫©n Backend)
###  Read:
	Redis  Miss  Lock  DB  Redis  Return
###  Write:
	Update DB  DEL Redis  MQ Notify
---
#  8. T√≥m t·∫Øt ng·∫Øn g·ªçn c·ª±c d·ªÖ nh·ªõ
	| Kh√°i ni·ªám      | B·∫£n ch·∫•t              |
	| -------------- | --------------------- |
	| Cache Miss     | Kh√¥ng c√≥ cache        |
	| Outdated Cache | Cache b·ªã sai          |
	| Nguy hi·ªÉm h∆°n  | ‚úÖ Outdated            |
	| Miss x·ª≠ l√Ω     | Cache Aside + Lock    |
	| Outdated x·ª≠ l√Ω | Update DB ‚Üí DEL cache |
---
N·∫øu b·∫°n mu·ªën, t√¥i c√≥ th·ªÉ ti·∫øp t·ª•c cho b·∫°n:
 Demo Cache Miss + Stampede b·∫±ng Redis + Java
 Code Spring Boot @Cacheable th·ª±c t·∫ø & b·∫´y th∆∞·ªùng g·∫∑p
 Chi·∫øn l∆∞·ª£c Cache cho Microservice l·ªõn
 So s√°nh Redis Cache vs CDN Cache
B·∫°n ƒëang d√πng Redis theo h∆∞·ªõng:
* API backend
* Game server
* E-commerce
* Hay Microservice?